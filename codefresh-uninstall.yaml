version: '1.0'
steps:

  check_env:
    image: bash:4.4.23
    commands:
      - echo 'Checking for CLUSTER_NAME, AWS_ACCESS_KEY_ID, and AWS_SECRET_ACCESS_KEY...'
      - '[[ -z $CLUSTER_NAME || -z $AWS_ACCESS_KEY_ID || -z $AWS_SECRET_ACCESS_KEY ]] && exit 1 || true'

  load_tfstate:
    image: codefresh/cli:0.8.54
    commands:
      - apk add --update make bash
      - make codefresh-load-tfstate

  teardown_eks_cluster:
    image: hashicorp/terraform:0.11.7
    commands:
      - apk add --update make bash
      - make teardown

  remove_tfstate:
    image: codefresh/cli:0.8.54
    commands:
      - apk add --update make bash
      - make codefresh-remove-tfstate
